<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
     <title>AgriVision | PMFBY Crop Damage AI</title>


    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f8f9fa;
        }
        h1 {
            color: green;
        }
        .box {
            background: white;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
            box-shadow: 0 0 5px #ccc;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: center;
        }
        th {
            background: #e9ecef;
        }
        button {
            padding: 6px 10px;
            margin: 3px;
            cursor: pointer;
        }
        .approve {
            background: green;
            color: white;
        }
        .reject {
            background: red;
            color: white;
        }
    </style>
</head>
<body>

<h1>AgriVision – AI Crop Damage Detection (PMFBY)</h1>
<p style="color:gray;">
Government of India | PMFBY Crop Insurance Prototype
</p>


<!-- ================= Farmer Upload ================= -->
<div class="box">
    <h2>Farmer Upload</h2>

    Crop:
    <select id="crop">
        <option>Tomato</option>
        <option>Pepper</option>
        <option>Wheat</option>
    </select><br><br>

    Upload Image:
    <input type="file" id="image"><br><br>

    <button onclick="analyze()">Analyze</button>

    <p id="result"></p>
    <p id="location"></p>
</div>

<!-- ================= Officer Dashboard ================= -->
<div class="box">
    <h2>Officer Dashboard</h2>

    <table id="dashboard">
        <tr>
            <th>ID</th>
            <th>Crop</th>
            <th>Damage %</th>
            <th>Result</th>
            <th>Location</th>
            <th>Status</th>
            <th>Approved Amount (₹)</th>
            <th>Action</th>
        </tr>
    </table>
</div>

<script>
let id = 1;

// Dummy PMFBY fund logic
function calculateAmount(damage) {
    if (damage >= 80) return 50000;
    if (damage >= 50) return 30000;
    if (damage >= 30) return 15000;
    return 0;
}

function analyze() {
    const crop = document.getElementById("crop").value;

    // Dummy AI output (replace with backend later)
    const damage = (Math.random() * 100).toFixed(2);
    const result = damage >= 50 ? "Damaged" : "Healthy";

    document.getElementById("result").innerText =
        `Result: ${result} | Damage: ${damage}%`;

    // Location
    navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude.toFixed(4);
        const lon = pos.coords.longitude.toFixed(4);

        document.getElementById("location").innerText =
            `Location: Lat ${lat}, Lon ${lon}`;

        addRow(crop, damage, result, lat, lon);
    });
}

function addRow(crop, damage, result, lat, lon) {
    const table = document.getElementById("dashboard");
    const row = table.insertRow();

    row.innerHTML = `
        <td>${id++}</td>
        <td>${crop}</td>
        <td>${damage}%</td>
        <td>${result}</td>
        <td>Lat: ${lat}, Lon: ${lon}</td>
        <td class="status">Pending</td>
        <td class="amount">-</td>
        <td>
            <button class="approve" onclick="approve(this, ${damage})">Approve</button>
            <button class="reject" onclick="reject(this)">Reject</button>
        </td>
    `;
}

function approve(btn, damage) {
    const row = btn.parentElement.parentElement;
    row.querySelector(".status").innerText = "Approved";
    row.querySelector(".amount").innerText = calculateAmount(damage);
}

function reject(btn) {
    const row = btn.parentElement.parentElement;
    row.querySelector(".status").innerText = "Rejected";
    row.querySelector(".amount").innerText = "0";
}
</script>

</body>
</html>
